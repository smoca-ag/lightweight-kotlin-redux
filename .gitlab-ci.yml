stages:
  - lint
  - build
  - publish

variables:
  GIT_SUBMODULE_STRATEGY: recursive
  ARTIFACTS_ANDROID: "./app/build"

.base_job:
  before_script:
    - set -euxo pipefail
    - brew install openjdk@17
    - export JAVA_HOME=$(brew --prefix openjdk@17)
  tags:
    - android_sdk_30

lint/kmp:
  extends: .base_job
  stage: lint
  script:
    - cd kmp
    - ./gradlew lint

build/kmp:
  extends: .base_job
  stage: build
  script:
    - cd kmp
    - ./gradlew :redux:assemble

publish/library:
  extends: .base_job
  stage: publish
  script:
    - cd kmp
    - ORG_GRADLE_PROJECT_key = base64 -Ddi $SIGNING_SECRING
    - ORG_GRADLE_PROJECT_keyId = $SIGNING_KEY_ID
    - ORG_GRADLE_PROJECT_pw = $SIGNING_PW
    - ./gradlew publish

